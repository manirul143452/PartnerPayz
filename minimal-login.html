<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - PartnerPayz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .login-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 350px;
        }
        
        h1 {
            color: #1877f2;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .instructions {
            background-color: #e7f3ff;
            border-left: 4px solid #1877f2;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .login-btn {
            background-color: #1877f2;
            color: white;
        }
        
        .test-btn {
            background-color: #42b72a;
            color: white;
        }
        
        .message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status {
            background-color: #f1f1f1;
            padding: 10px;
            margin-top: 20px;
            font-size: 14px;
            border-radius: 5px;
            height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h1>PartnerPayz Login</h1>
        
        <div class="instructions">
            <p><strong>Instructions:</strong></p>
            <p>1. Click the "Login as Test User" button below for instant login</p>
            <p>2. Or enter email: <strong>test@example.com</strong> and password: <strong>password123</strong></p>
        </div>
        
        <input type="email" id="email" placeholder="Email" value="test@example.com">
        <input type="password" id="password" placeholder="Password" value="password123">
        
        <button class="login-btn" id="loginBtn">Login</button>
        <button class="test-btn" id="testLoginBtn">Login as Test User</button>
        
        <div id="message" class="message"></div>
        
        <div class="status" id="status">
            <div>Status: Ready to login</div>
        </div>
    </div>

    <script>
        // Get elements
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const testLoginBtn = document.getElementById('testLoginBtn');
        const messageDiv = document.getElementById('message');
        const statusDiv = document.getElementById('status');
        
        // Setup on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Setup localStorage
            try {
                // Initialize users if needed
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                    log('Initialized users storage');
                }
                
                // Create test user
                createTestUser();
                
                // Check for existing login
                checkExistingLogin();
            } catch (error) {
                showError('Setup error: ' + error.message);
                log('Setup error: ' + error.message);
            }
            
            // Add event listeners
            loginBtn.addEventListener('click', handleLogin);
            testLoginBtn.addEventListener('click', handleTestLogin);
        });
        
        // Handle login
        function handleLogin() {
            try {
                // Get values
                const email = emailInput.value.trim();
                const password = passwordInput.value;
                
                // Validate
                if (!email || !password) {
                    throw new Error('Email and password are required');
                }
                
                // Disable button
                loginBtn.disabled = true;
                loginBtn.textContent = 'Logging in...';
                
                log('Attempting login: ' + email);
                
                // Get users
                const users = getUsers();
                
                // Find user
                const user = users.find(u => 
                    u.email.toLowerCase() === email.toLowerCase() && 
                    u.password === password
                );
                
                if (user) {
                    // Login successful
                    loginSuccess(user);
                } else {
                    // Login failed
                    throw new Error('Invalid email or password');
                }
            } catch (error) {
                // Show error
                showError(error.message);
                log('Login error: ' + error.message);
                
                // Re-enable button
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login';
            }
        }
        
        // Handle test login
        function handleTestLogin() {
            try {
                // Disable button
                testLoginBtn.disabled = true;
                testLoginBtn.textContent = 'Logging in...';
                
                log('Using test login');
                
                // Get test user
                const users = getUsers();
                const testUser = users.find(u => u.email === 'test@example.com');
                
                if (testUser) {
                    // Login successful
                    loginSuccess(testUser);
                } else {
                    // Create and login
                    const newTestUser = createTestUser();
                    loginSuccess(newTestUser);
                }
            } catch (error) {
                // Show error
                showError(error.message);
                log('Test login error: ' + error.message);
                
                // Re-enable button
                testLoginBtn.disabled = false;
                testLoginBtn.textContent = 'Login as Test User';
            }
        }
        
        // Login success handler
        function loginSuccess(user) {
            // Update last login
            updateUserLastLogin(user);
            
            // Set as current user
            setCurrentUser(user.id);
            
            // Show success message
            showSuccess('Login successful! Redirecting...');
            log('Login successful: ' + user.email);
            
            // Redirect
            setTimeout(function() {
                window.location.href = 'dashboard.html';
            }, 1500);
        }
        
        // Create test user if doesn't exist
        function createTestUser() {
            try {
                const users = getUsers();
                
                // Check if test user exists
                let testUser = users.find(u => u.email === 'test@example.com');
                
                if (!testUser) {
                    // Create new test user
                    testUser = {
                        id: 'test_user_' + Date.now(),
                        email: 'test@example.com',
                        password: 'password123',
                        name: 'Test User',
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };
                    
                    // Add to users
                    users.push(testUser);
                    saveUsers(users);
                    
                    log('Test user created');
                } else {
                    log('Test user already exists');
                }
                
                return testUser;
            } catch (error) {
                log('Error creating test user: ' + error.message);
                return null;
            }
        }
        
        // Check for existing login
        function checkExistingLogin() {
            try {
                const currentUserId = getCurrentUserId();
                
                if (currentUserId) {
                    const users = getUsers();
                    const user = users.find(u => u.id === currentUserId);
                    
                    if (user) {
                        log('Existing login found: ' + user.email);
                        showSuccess('You are already logged in. Redirecting...');
                        
                        setTimeout(function() {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    } else {
                        log('Invalid user ID, removing');
                        removeCurrentUser();
                    }
                }
            } catch (error) {
                log('Error checking login: ' + error.message);
            }
        }
        
        // Get users from localStorage
        function getUsers() {
            try {
                const usersJson = localStorage.getItem('users');
                return usersJson ? JSON.parse(usersJson) : [];
            } catch (error) {
                log('Error getting users: ' + error.message);
                return [];
            }
        }
        
        // Save users to localStorage
        function saveUsers(users) {
            try {
                localStorage.setItem('users', JSON.stringify(users));
            } catch (error) {
                log('Error saving users: ' + error.message);
            }
        }
        
        // Update user's last login
        function updateUserLastLogin(user) {
            try {
                const users = getUsers();
                const index = users.findIndex(u => u.id === user.id);
                
                if (index !== -1) {
                    users[index].lastLogin = new Date().toISOString();
                    saveUsers(users);
                }
            } catch (error) {
                log('Error updating last login: ' + error.message);
            }
        }
        
        // Get current user ID
        function getCurrentUserId() {
            return localStorage.getItem('currentUserId');
        }
        
        // Set current user
        function setCurrentUser(userId) {
            localStorage.setItem('currentUserId', userId);
        }
        
        // Remove current user
        function removeCurrentUser() {
            localStorage.removeItem('currentUserId');
        }
        
        // Show success message
        function showSuccess(message) {
            messageDiv.textContent = message;
            messageDiv.className = 'message success';
            messageDiv.style.display = 'block';
        }
        
        // Show error message
        function showError(message) {
            messageDiv.textContent = message;
            messageDiv.className = 'message error';
            messageDiv.style.display = 'block';
        }
        
        // Log status message
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.textContent = `[${timestamp}] ${message}`;
            statusDiv.prepend(logItem);
            console.log(`[${timestamp}] ${message}`);
        }
    </script>
</body>
</html> 